<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Tourist Safety - MCPT System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-content">
            <h1 class="nav-title">
                <span class="icon">üé•</span>
                Smart Tourist Safety System
                <span class="subtitle">Multi-Camera People Tracking</span>
            </h1>
            <div class="nav-status">
                <a href="/register" class="btn btn-success" style="margin-right: 1rem; text-decoration: none;">
                    ‚ûï Register Tourist
                </a>
                <span id="statusBadge" class="badge badge-stopped">‚óè STOPPED</span>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Control Panel -->
        <div class="control-panel card">
            <h2 class="card-title">‚öôÔ∏è Camera Control Panel</h2>
            
            <!-- Tab Navigation -->
            <div class="tab-navigation">
                <button class="tab-btn active" onclick="switchTab(1)">
                    üì∑ Camera 1
                </button>
                <button class="tab-btn" onclick="switchTab(2)">
                    üì∑ Camera 2
                </button>
            </div>

            <!-- Camera 1 Settings -->
            <div id="cameraSettings1" class="camera-settings active">
                <div class="settings-header">
                    <h3>üì∑ Camera 1 Configuration</h3>
                    <span id="camera1Badge" class="status-badge inactive">‚óè Inactive</span>
                </div>

                <div class="form-group">
                    <label for="videoSource1">Video Source</label>
                    <select id="videoSource1" class="input-select" onchange="handleSourceChange(1)">
                        <option value="webcam">üì∑ Webcam</option>
                        <option value="video" selected>üé¨ Video File (MP4)</option>
                        <option value="esp32cam">üì° ESP32-CAM (URL)</option>
                    </select>
                </div>

                <div class="form-group" id="videoPathGroup1">
                    <label for="videoPath1">Video File Path</label>
                    <input type="text" id="videoPath1" class="input-text" 
                           placeholder="videos/sample.mp4" value="videos/sample.mp4">
                </div>

                <div class="form-group" id="esp32UrlGroup1" style="display: none;">
                    <label for="esp32Url1">ESP32-CAM Stream URL</label>
                    <input type="text" id="esp32Url1" class="input-text" 
                           placeholder="http://192.168.1.100:81/stream">
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="startCamera(1)">
                        <span class="btn-icon">‚ñ∂Ô∏è</span> Start Camera 1
                    </button>
                    <button class="btn btn-danger" onclick="stopCamera(1)">
                        <span class="btn-icon">‚èπÔ∏è</span> Stop Camera 1
                    </button>
                </div>
            </div>

            <!-- Camera 2 Settings -->
            <div id="cameraSettings2" class="camera-settings">
                <div class="settings-header">
                    <h3>üì∑ Camera 2 Configuration</h3>
                    <span id="camera2Badge" class="status-badge inactive">‚óè Inactive</span>
                </div>

                <div class="form-group">
                    <label for="videoSource2">Video Source</label>
                    <select id="videoSource2" class="input-select" onchange="handleSourceChange(2)">
                        <option value="webcam">üì∑ Webcam</option>
                        <option value="video" selected>üé¨ Video File (MP4)</option>
                        <option value="esp32cam">üì° ESP32-CAM (URL)</option>
                    </select>
                </div>

                <div class="form-group" id="videoPathGroup2">
                    <label for="videoPath2">Video File Path</label>
                    <input type="text" id="videoPath2" class="input-text" 
                           placeholder="videos/sample2.mp4" value="videos/sample.mp4">
                </div>

                <div class="form-group" id="esp32UrlGroup2" style="display: none;">
                    <label for="esp32Url2">ESP32-CAM Stream URL</label>
                    <input type="text" id="esp32Url2" class="input-text" 
                           placeholder="http://192.168.1.101:81/stream">
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="startCamera(2)">
                        <span class="btn-icon">‚ñ∂Ô∏è</span> Start Camera 2
                    </button>
                    <button class="btn btn-danger" onclick="stopCamera(2)">
                        <span class="btn-icon">‚èπÔ∏è</span> Stop Camera 2
                    </button>
                </div>
            </div>
            <!-- Add this after the camera tabs section in Control Panel -->

            <!-- Tourist Search Section -->
            <div style="margin-top: 2rem; padding-top: 2rem; border-top: 2px solid #e5e7eb;">
                <h3 style="color: #1f2937; margin-bottom: 1rem;">üîç Search Tourist</h3>
                
                <div class="form-group">
                    <label for="searchDID">Digital Identity (DID)</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="text" id="searchDID" class="input-text" 
                            placeholder="did:tourist:abc123" style="flex: 1;">
                        <button class="btn btn-primary" onclick="searchTourist()">
                            üîç Search
                        </button>
                    </div>
                </div>
                
                <div id="searchResult" style="margin-top: 1rem; display: none;">
                    <div style="background: #f9fafb; padding: 1rem; border-radius: 8px;">
                        <h4 style="color: #10b981; margin-bottom: 0.5rem;">Tourist Found ‚úÖ</h4>
                        <div id="touristInfo" style="font-size: 0.9rem; color: #6b7280;">
                            <!-- Tourist info will be displayed here -->
                        </div>
                        <button class="btn btn-primary" onclick="viewTrajectory()" style="margin-top: 1rem;">
                            üìç View Trajectory
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Video Section -->
            <div class="video-section">
                <div class="card">
                    <h2 class="card-title">üìπ Camera Feeds</h2>
                    
                    <!-- Camera Grid (2 feeds) -->
                    <div class="camera-grid">
                        <!-- Camera 1 -->
                        <div class="camera-container">
                            <div class="camera-header">
                                <span class="camera-label">üì∑ Camera 1</span>
                                <span id="camera1Status" class="camera-status">Inactive</span>
                            </div>
                            <div class="video-container">
                                <img id="videoFeed1" src="" alt="Camera 1 Feed" class="video-feed">
                                <div id="noVideoPlaceholder1" class="no-video">
                                    <div class="placeholder-content">
                                        <span class="placeholder-icon">üìπ</span>
                                        <p>Camera 1 Inactive</p>
                                        <p class="placeholder-hint">Configure and start above</p>
                                    </div>
                                </div>
                                <div id="recordingIndicator1" class="recording-indicator" style="display: none;">
                                    <span class="pulse-dot"></span> DETECTING
                                </div>
                            </div>
                        </div>
                        
                        <!-- Camera 2 -->
                        <div class="camera-container">
                            <div class="camera-header">
                                <span class="camera-label">üì∑ Camera 2</span>
                                <span id="camera2Status" class="camera-status">Inactive</span>
                            </div>
                            <div class="video-container">
                                <img id="videoFeed2" src="" alt="Camera 2 Feed" class="video-feed">
                                <div id="noVideoPlaceholder2" class="no-video">
                                    <div class="placeholder-content">
                                        <span class="placeholder-icon">üìπ</span>
                                        <p>Camera 2 Inactive</p>
                                        <p class="placeholder-hint">Configure and start above</p>
                                    </div>
                                </div>
                                <div id="recordingIndicator2" class="recording-indicator" style="display: none;">
                                    <span class="pulse-dot"></span> DETECTING
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats & Detections -->
            <div class="sidebar">
                <!-- Real-time Stats -->
                <div class="card">
                    <h2 class="card-title">üìä Real-Time Statistics</h2>
                    <div class="stats-grid">
                        <div class="stat-box stat-primary">
                            <div class="stat-icon">‚ö°</div>
                            <div class="stat-content">
                                <div class="stat-label">Avg FPS</div>
                                <div class="stat-value" id="fpsValue">0</div>
                            </div>
                        </div>
                        <div class="stat-box stat-success">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-content">
                                <div class="stat-label">Total Persons</div>
                                <div class="stat-value" id="personsValue">0</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-section">
                        <div class="info-item">
                            <span class="info-label">AI Device:</span>
                            <span id="deviceInfo" class="info-value">Loading...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Model:</span>
                            <span class="info-value">YOLOv8n</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Status:</span>
                            <span id="systemStatus" class="info-value">Ready</span>
                        </div>
                    </div>
                </div>

                <!-- Detection List -->
                <div class="card detections-card">
                    <h2 class="card-title">üéØ Active Detections (Updates every 15s)</h2>
                    <div id="detectionsList" class="detections-list">
                        <div class="empty-state">
                            <span class="empty-icon">üì≠</span>
                            <p>No detections yet</p>
                            <p class="empty-hint">Start cameras to see results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Smart Tourist Safety System | SIH 2025 | Multi-Camera People Tracking Demo</p>
    </footer>

    <!-- Socket.IO -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
